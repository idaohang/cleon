<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>CLEON: Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CLEON
   &#160;<span id="projectnumber">Version 1</span>
   </div>
   <div id="projectbrief">Cloud-Offloaded GPS Receiver</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_u_s_a_g_e.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="QUICK"></a>
Quick start guide</h1>
<ul>
<li>Below are a few steps to help you get started<ol type="1">
<li>Turn on the CLEON device</li>
<li>Connect CLEON to PC using USB cable</li>
<li>Launch PC based software 'CLEON_Connector' for time sychronization and user parameter update</li>
<li>In the 'CLEON_Connetor', change user paramters to desired values<br/>
 (If there's an error for the value of parameter, it is impossible to update user parameters)<br/>
 (Although battery capacity is used as parameter, this is used only to calculate rough estimate whether desired number of samples can be captured with the capacity)</li>
<li>Select the COM port that CLEON is connected to</li>
<li>Then, press 'Connect' button</li>
<li>Once COM port is successfully opened, 'Connect to CLEON (1/3)' button will be enabled</li>
<li>Once CLEON is successfully connected, 'Connect to CLEON (1/3)' button will be changed to 'Update parameters (2/3)'</li>
<li>Press 'Update parameters (2/3)' to update CLEON with user parameters (sample count, sample gap, chunk count, chunk gap)</li>
<li>Once user parameters are successfully updated, 'Update parameters (2/3)' button will be changed to 'Update CLEON time tick (3/3)'</li>
<li>Press 'Update CLEON time tick (3/3)' to update CLEON system time (RTC time and millisecond time tick)</li>
<li>'CLEON_Connector' will notify of successful update by showing 'Time tick sent successfully' in status bar</li>
<li>Now that user parameters are updated and CLEON system time is synchronized, CLEON is ready to capture GPS and sensor data</li>
<li>Press user-button on CLEON to start logging</li>
<li>If MicroSD is properly inserted, CLEON starts to log GPS and sensor data repeatedly as defined<br/>
</li>
<li>At the first time, CLEON creates directory named 'CLEON' in MicroSD card and creates log file whose name is starting with current time tick under the directory 'CLEON'</li>
<li>The file will remain opened until defined number of GPS and sensor data is logged and written <br/>
 (meaning that data will be appended to the opened file)<br/>
 (This is to save energy consumed by seeking access to MicroSD)</li>
<li>If defined number of samples are captured, new file will be created for next logging</li>
<li>If MicroSD card is suddenly removed, MicroSD error LED will be turned on (however, data captured until error will remain uncorrupted)<br/>
</li>
<li>If MicroSD is inserted back to the slot again, CLEON will initialze the file system again</li>
</ol>
</li>
</ul>
<h1><a class="anchor" id="LED"></a>
LED Indicator</h1>
<ul>
<li>There are 6 LEDs between MicroSD card slot and JTAG header</li>
<li>Let's call the LEDs as LED1 to LED6 from the leftmost LED which is closest to MicroSD card slot</li>
<li>LED1 and LED3 are used to indicate errors<br/>
 (If everything goes well and GPS signal is ready to be captured, LED1 and LED3 should be automatically turned off by the firmware)<ul>
<li>LED1<ul>
<li>ON : MicroSD is missing</li>
<li>OFF : MicroSD is in the slot</li>
</ul>
</li>
<li>LED2<ul>
<li>ON : GPS signal is being captured</li>
<li>OFF : GPS signal is not being captured</li>
</ul>
</li>
<li>LED3<ul>
<li>ON : Time is not synchronized</li>
<li>OFF : Time is synchrinized</li>
</ul>
</li>
<li>LED4<ul>
<li>N/A</li>
</ul>
</li>
<li>LED5<ul>
<li>N/A</li>
</ul>
</li>
<li>LED6<ul>
<li>ON : GPS is not functioning</li>
<li>OFF : GPS is operational</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="TIME"></a>
System time</h1>
<ul>
<li>CLEON maintains two distinct system time: <b>Time</b> <b>tick</b> and <b>RTC</b> <b>time</b> <ul>
<li>Time tick<ul>
<li>Mainly used for GPS and sensor data time stamp</li>
<li>Set to zero when initial power-up</li>
<li>Need to be synchronized with UTC time tick in DateTime format<br/>
 (<a href="http://msdn.microsoft.com/en-us/library/system.datetime.ticks.aspx">http://msdn.microsoft.com/en-us/library/system.datetime.ticks.aspx</a>)<br/>
 (10,000 tick is equal to 1 millisecond)</li>
<li>Variables used: uniSecondTimeTick, uniMillisecondTimeTick<ul>
<li>'uniMillisecondTimeTick' is incremented by 10,000 in every millisecond</li>
<li>'uniSecondTimeTick' is incremented by 10,000,000 in every second</li>
<li>By combining those two, it is possible to get current CLEON UTC time tick</li>
</ul>
</li>
</ul>
</li>
<li>RTC time<ul>
<li>Mainly used for FAT file system time stamp</li>
<li>Set to 00:00:00 of 1-Jan-1980 when initial power-up (Time synchronization required)</li>
<li>Generates an interrupt in every second<ul>
<li>In this ISR, 'uniSecondTimeTick' is incremented by 10,000,000 and 'uniMillisecondTimeTick' is reset to zero</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Maintaining synchronized time<ul>
<li>Once time synchronization message is received, CLEON stores the pair of RTC time and time tick to internal FLASH for future use</li>
<li>The synchronized time (both RTC time and time tick) is maintained even when primary power supply (in our case, LiPo battery) is drained out<ul>
<li>MSP430 has SVSH, which supervises the primary supply (in our case, LiPo battery)</li>
<li>When the primary supply falls below the configured SVSH level, SVSH initiates backup system and puts MSP430 into reset state (SVSH(POR))<br/>
 (Currently, SVSH voltage is set to 2.04V)</li>
<li>When backup system is in place, RTC is powered by backup battery (VBAT) and kept running even when the primary supply fails<br/>
 <b></b>(WARNING!!) (Note that this scenario is NOT applicable to sudden battery removal becuase MSP430 requires some time to initiate backup system)</li>
<li>Once CLEON is powered up again, CLEON retrieves the time information, which was stored into internal FLASH when synchronization message was received</li>
<li>CLEON restores current UTC time tick by adding the difference between current and stored RTC time to previously stored UTC time tick<br/>
 (Note that time synchronization error LED will be turned on if there's a problem in time synchronization or restoration)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="USB"></a>
USB frame</h1>
<ul>
<li>USB frame is used for exchanging data between CLEON and USB host (typically, PC)</li>
<li>USB frame is 36 bytes in total</li>
<li>USB frame starts with 2 bytes(0x55) of header and ends with 2 bytes(0xAA) of footer</li>
<li>Length fields includes the length of data plus one (meaning that length field itself is considered as data)</li>
<li>There should be an ACK for every data frame exchanged</li>
<li>The figure below decribes the format of the USB frame<ul>
<li>USB data frame <div class="image">
<img src="usb_data_frame.jpg" alt="usb_data_frame.jpg"/>
</div>
</li>
<li>USB ack frame <div class="image">
<img src="usb_ack_frame.jpg" alt="usb_ack_frame.jpg"/>
</div>
</li>
</ul>
</li>
</ul>
<ul>
<li>Time synchronization message is exchanged by using USB</li>
<li>The sequence chart below describes the communication between CLEON and PC <div align="center">
<img src="msc_inline_mscgraph_1.png" alt="msc_inline_mscgraph_1" border="0" usemap="#msc_inline_mscgraph_1.map"/>
<map name="msc_inline_mscgraph_1.map" id="msc_inline_mscgraph_1.map"></map>
</div>
 </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue May 28 2013 15:08:41 for CLEON by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
